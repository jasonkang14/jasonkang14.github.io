{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/Django-upload-image-to-aws-s3","result":{"data":{"markdownRemark":{"id":"17a59702-9193-5ccf-aa75-c81a24052c82","html":"<p>After receiving an image file from a client, you have to use a server to upload the image to AWS S3. I am not going to post about how to set up IAM and S3 Bucket in AWS as I believe there are already so many posts about it.</p>\n<p>If you want to upload an image to AWS S3, you need to first install <code class=\"language-text\">boto3</code>, which is a library that helps you upload a file to AWS S3.</p>\n<p><code class=\"language-text\">pip install boto3</code> <br>\nand please build a habit of <code class=\"language-text\">pip freeze > requirements.txt</code> in order to help those who are working on the same project with you.</p>\n<p>Check out the code below</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UploadPictureView</span><span class=\"token punctuation\">(</span>APIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    permission_classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>IsAuthenticated<span class=\"token punctuation\">]</span>\n    s3_client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'s3'</span><span class=\"token punctuation\">,</span>\n        aws_access_key_id     <span class=\"token operator\">=</span> yptest_aws_access_key_id<span class=\"token punctuation\">,</span>\n        aws_secret_access_key <span class=\"token operator\">=</span> yptest_aws_secret_access_key\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        picture <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>FILES<span class=\"token punctuation\">[</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">]</span>\n        picture<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>picture<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n\n        self<span class=\"token punctuation\">.</span>s3_client<span class=\"token punctuation\">.</span>upload_fileobj<span class=\"token punctuation\">(</span>\n            picture<span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"yptest-sns\"</span><span class=\"token punctuation\">,</span>\n            picture<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"picture_uri\"</span><span class=\"token punctuation\">:</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"https://yptest-sns.s3.ap-northeast-2.amazonaws.com/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>picture<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> safe<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>You can retrieve your <code class=\"language-text\">aws_access_key_id</code> and <code class=\"language-text\">aws_secret_access_key</code> from your <code class=\"language-text\">AWS IAM</code>. <br></p>\n<p>Once you upload an image to <code class=\"language-text\">AWS S3</code>, it provides you with an uri specific to the image by adding the image file name to the end of the <code class=\"language-text\">S3 bucket uri</code>. So if you return the uri to your client, the client will send a request to your server with the uri to save the information into your database</p>","fields":{"slug":"/posts/2019//posts/Django-upload-image-to-aws-s3","tagSlugs":["/tag/django/","/tag/cloud/"]},"frontmatter":{"date":"2019-08-07T22:27:37.121Z","description":"How to upload an image to AWS S3 using Django","tags":["Django","Cloud"],"title":"Django - Upload Image to AWS S3","socialImage":null}}},"pageContext":{"slug":"/posts/2019//posts/Django-upload-image-to-aws-s3"}},"staticQueryHashes":["251939775","288581551","401334301"]}