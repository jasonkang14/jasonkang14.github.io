{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/hadoop/managing-hadoop-tasks-with-oozie","result":{"data":{"markdownRemark":{"id":"348200d1-511c-5dcb-ba7e-55533cee43bc","html":"<p><a href=\"https://oozie.apache.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Oozie</a>는 hadoop workflow를 관리할 수 있는 스케쥴러이다. 따라서 hadoop task를 돌리고, 스케쥴링 할 수 있으며, periodic job들을 처리할 수 있다.</p>\n<p>xml로 작성된 workflow를 통해 다양한 action들을 엮을 수 있는데, MapReduce, Hive, Pig,  Sqoop, 등등을 순차적으로, 그리고 병렬적으로 처리할 수 있다. 일반적인 oozie의 workflow는 아래와 같다.</p>\n<p><img src=\"https://i.imgur.com/xYsP57c.png\" alt=\"oozie-workflow\"></p>\n<p>각각의 영역(?)을 node라고 부른다. <code class=\"language-text\">start</code> node와 <code class=\"language-text\">end</code> node는 말 그대로 시작과 끝을 나타낸다. <code class=\"language-text\">fork</code> node는 다음 action들—여기서는 pig와 sqoop job—을 시작하라는 명령을 하고, <code class=\"language-text\">join</code>은 dependency들—여기서는 pig와 sqoop job—이 완료되면 다음 action을 시작하라는 명령을 한다.</p>\n<p>위 workflow를 xml로 보면 아래와 같다.</p>\n<p><img src=\"https://i.imgur.com/4xERcTR.png\" alt=\"oozie-workflow-in-xml\"></p>\n<p>각 xml tag를 보면 <code class=\"language-text\">name</code>과 <code class=\"language-text\">to</code>가  있는데, <code class=\"language-text\">name</code>은 해당 node에 부여된 고유값이고, <code class=\"language-text\">to</code>는 지금 <code class=\"language-text\">node</code>가 끝나면 어떤 <code class=\"language-text\">node</code>를 실행할 것인지를 나타낸다. 예를들어</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>join</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>joining<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hive-node<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>의 경우에는, 해당 join node의 고유값은 <code class=\"language-text\">joining</code> 이고, 해당 node가 잘 끝나면 <code class=\"language-text\">hive-node</code>로 이동하라는 뜻이다. 위의 workflow의 diagram과 일치한다.</p>\n<p>예제에 나온 node들 이외에 switch-case를 사용해서 선택을 하도록 할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>workflow-app</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>foo-wf<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uri:oozie:workflow:0.1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    ...\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>decision</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mydecision<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>switch</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>case</span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>reconsolidatejob<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n              ${fs:fileSize(secondjobOutputDir) gt 10 * GB}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>case</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>case</span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rexpandjob<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n              ${fs:filSize(secondjobOutputDir) lt 100 * MB}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>case</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>case</span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>recomputejob<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n              ${ hadoop:counters('secondjob')[RECORDS][REDUCE_OUT] lt 1000000 }\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>case</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>default</span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>end<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>switch</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>decision</span><span class=\"token punctuation\">></span></span>\n    ...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>workflow-app</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Oozie workflow를 설정하고 구동하기 위해서는 HDFS에 디렉토리를 만들고, 해당 디렉토리에 <code class=\"language-text\">workflow.xml</code>을 작성하면 된다. <code class=\"language-text\">job.properties</code>에 <code class=\"language-text\">workflow.xml</code>에 필요한 변수들을 저장하고, 다양한 workflow들에서 사용하게 할 수도 있다.</p>\n<p>Oozie에는 <code class=\"language-text\">coordinator</code>라는게 존재하는데, 말 그대로 oozie workflow를 관리하는 것이다. 하나의 coordinator에 cronjob이나 interval로 oozie workflow들을 돌릴 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>coordinator-app</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hello-coord<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">frequency</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>${coord:days(1)}<span class=\"token punctuation\">\"</span></span>\n                  <span class=\"token attr-name\">start</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2009-01-02T08:00Z<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">end</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2009-01-04T08:00Z<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">timezone</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>America/Los_Angeles<span class=\"token punctuation\">\"</span></span>\n                 <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uri:oozie:coordinator:0.1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>controls</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>timeout</span><span class=\"token punctuation\">></span></span>10<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>timeout</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>concurrency</span><span class=\"token punctuation\">></span></span>${concurrency_level}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>concurrency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>execution</span><span class=\"token punctuation\">></span></span>${execution_order}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>execution</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>throttle</span><span class=\"token punctuation\">></span></span>${materialization_throttle}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>throttle</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>controls</span><span class=\"token punctuation\">></span></span>      \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>datasets</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataset</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>din<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">frequency</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>${coord:endOfDays(1)}<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">initial-instance</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2009-01-02T08:00Z<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">timezone</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>America/Los_Angeles<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uri-template</span><span class=\"token punctuation\">></span></span>${baseFsURI}/${YEAR}/${MONTH}/${DAY}/${HOUR}/${MINUTE}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>uri-template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataset</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataset</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dout<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">frequency</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>${coord:minutes(30)}<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">initial-instance</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2009-01-02T08:00Z<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">timezone</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uri-template</span><span class=\"token punctuation\">></span></span>${baseFsURI}/${YEAR}/${MONTH}/${DAY}/${HOUR}/${MINUTE}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>uri-template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataset</span><span class=\"token punctuation\">></span></span>\n  ...</code></pre></div>\n<p>최상단의 부모 tag가 <code class=\"language-text\">workflow</code>에서 <code class=\"language-text\">coordinator</code>로 다른 것을 확인할 수 있다.\n그리고 이 coordinator를 모아둔 <code class=\"language-text\">bundle</code>도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bundle-app</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>[NAME]</span>  <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>uri:oozie:bundle:0.1<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span> \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>controls</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>kick-off-time</span><span class=\"token punctuation\">></span></span>[DATETIME]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>kick-off-time</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>controls</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>coordinator</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>[NAME]</span> <span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>app-path</span><span class=\"token punctuation\">></span></span>[COORD-APPLICATION-PATH]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>app-path</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>[PROPERTY-NAME]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>[PROPERTY-VALUE]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span>\n      ...\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>coordinator</span><span class=\"token punctuation\">></span></span>\n\t\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bundle-app</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>마찬가지로 최상단의 부모 tag가 <code class=\"language-text\">bundle</code>이고, 여기에는 여러 <code class=\"language-text\">coordinator</code>들이 들어갈 수 있다.</p>\n<p>다른 Workflow와 비교하자면, oozie는 사실상 거의 사용되지 않는 것 같다.\n<a href=\"https://star-history.com/#argoproj/argo-workflows&#x26;apache/airflow&#x26;mlflow/mlflow&#x26;spotify/luigi&#x26;apache/oozie&#x26;kubeflow/kubeflow&#x26;Date\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github Star로 보는 workflow들의 인기</a></p>\n<p>oozie는 사실상 인기를 얻었던 적도 없다.\n그리고 구글은 <a href=\"https://conferences.oreilly.com/strata/strata-eu-2019/cdn.oreillystatic.com/en/assets/1/event/292/Migrating%20Apache%20Oozie%20workflows%20to%20Apache%20Airflow%20Presentation.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">oozie에서 airflow로 migration하는 중</a>이라고 한다.</p>","fields":{"slug":"/posts/2022//hadoop/managing-hadoop-tasks-with-oozie","tagSlugs":["/tag/hadoop/"]},"frontmatter":{"date":"2022-09-18T19:41:37.121Z","description":"Oozie로 hadoop task를 실행해본다","tags":["Hadoop"],"title":"Oozie로 hadoop task 관리하기","socialImage":null}}},"pageContext":{"slug":"/posts/2022//hadoop/managing-hadoop-tasks-with-oozie"}},"staticQueryHashes":["251939775","288581551","401334301"]}