{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/azure/grafana-on-aks","result":{"data":{"markdownRemark":{"id":"76d64b9c-5b7a-5561-a839-d27b36fee5e0","html":"<p>글또콘에 다녀왔는데 같은 테이블에 앉은 분들이 <a href=\"https://grafana.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Grafana</a>로 쿠버네티스 모니터링을 한다고 해서 연동해보았다. 서버 모니터링이 중요해서 툴들을 찾아야겠다 라고 고민하고 있었는데, 많이들 쓴다니까 이걸로 가보기로 했다. 그 팀들에서 얼마나 많은 기술 검토를 통해 이 툴로 정했을까를 생각하면 많은 시간을 아낀 것 같다.</p>\n<p>Azure는 문서가 잘 안되어있는데 검색을 잘 한건지 <a href=\"https://techcommunity.microsoft.com/t5/apps-on-azure-blog/using-azure-kubernetes-service-with-grafana-and-prometheus/ba-p/3020459\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Using Azure Kubernetes Service with Grafana and Prometheus</a>라는 문서를 찾았다. 디테일한 명령어에는 오류가 있지만 그래도 꽤나 정확하다.</p>\n<p>Grafana는 시각화를 통한 모니터링이 가능하고 <a href=\"https://prometheus.io/docs/introduction/overview/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prometheus</a>도 모니터링 툴인데 그라파나랑 같이 도는 것 같다. 연동을 해보니 helm으로 Prometheus를 설치하면 Grafana도 같이 돌아간다.</p>\n<p>Prometheus repository를 helm repository에 추가하고 update를 진행한다</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm repo <span class=\"token function\">add</span> prometheus-community https://prometheus-community.github.io/helm-charts\n\nhelm repo update</code></pre></div>\n<p>그리고 쿠버네티스에 올린다. 문서에는 <code class=\"language-text\">--create-namespace</code>라는 명령어가 있지만, 나는 이미 있는 namespace에 추가하는 것이기 때문에 그건 생략한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">helm <span class=\"token function\">install</span> prometheus <span class=\"token punctuation\">\\</span>\n  prometheus-community/kube-prometheus-stack <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">--namespace</span> monitoring</code></pre></div>\n<p><img src=\"https://i.imgur.com/butuIrj.png\" alt=\"prometheus-online\"></p>\n<p>아주 잘 올라간 것을 볼 수 있다.</p>\n<p>이제 port fowarding을 통해 로컬에서 확인해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl port-forward <span class=\"token parameter variable\">-n</span> CUSTOM_NAMESPACE prometheus-promethus-kube-prometheus-prometheus-0 <span class=\"token number\">9090</span></code></pre></div>\n<p>포트가 9090번인 이유는 default port이기 때문이다. 이는 azure portal에서 확인할 수 있다.</p>\n<p><a href=\"http://localhost:9090%EC%97%90%EC%84%9C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:9090에서</a> prometheus가 잘 올라간 것을 확인할 수 있다.</p>\n<p><img src=\"https://i.imgur.com/mfUlkUK.png\" alt=\"prometheus-up-and-running\"></p>\n<p>사용법은 아직 잘 모르겠다. 천천히 알아가보도록 한다.\nport forwarding으로 grafana도 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl port-forward <span class=\"token parameter variable\">-n</span> CUSTOM_NAMESPACE promethus-grafana-5b8fc75d5c-2sfmk <span class=\"token number\">3000</span></code></pre></div>\n<p>로그인 아이디와 비밀번호가 필요한데, 이건 아래 명령어로 Secret 을 추출해서 사용하도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\nkubectl get secret <span class=\"token parameter variable\">-n</span> CUSTOM_NAMESPACE promethus-grafana-5b8fc75d5c-2sfmk <span class=\"token parameter variable\">-o</span><span class=\"token operator\">=</span>jsonpath<span class=\"token operator\">=</span><span class=\"token string\">'{.data.admin-user}'</span> <span class=\"token operator\">|</span>base64 <span class=\"token parameter variable\">-d</span>\n\nkubectl get secret <span class=\"token parameter variable\">-n</span> CUSTOM_NAMESPACE promethus-grafana-5b8fc75d5c-2sfmk <span class=\"token parameter variable\">-o</span><span class=\"token operator\">=</span>jsonpath<span class=\"token operator\">=</span><span class=\"token string\">'{.data.admin-password}'</span> <span class=\"token operator\">|</span>base64 <span class=\"token parameter variable\">-d</span></code></pre></div>\n<p><a href=\"http://localhost:3000%EC%97%90%EC%84%9C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000에서</a> grafana가 잘 올라간 것을 확인할 수 있다.</p>\n<p><img src=\"https://i.imgur.com/Vvu1z6E.png\" alt=\"grafana-up-and-running\"></p>\n<p>이걸로 다양한 것들을 할 수 있다고 하는데, 그것도 천천히 알아보도록 한다.</p>","fields":{"slug":"/posts/2022//azure/grafana-on-aks","tagSlugs":["/tag/kubernetes/","/tag/azure/"]},"frontmatter":{"date":"2022-09-05T19:41:37.121Z","description":"Grafana로 AKS 모니터링","tags":["Kubernetes","Azure"],"title":"Azure Kubernetes(AKS)를 Grafana로 모니터링","socialImage":null}}},"pageContext":{"slug":"/posts/2022//azure/grafana-on-aks"}},"staticQueryHashes":["251939775","288581551","401334301"]}